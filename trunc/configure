#!/bin/bash

INSTALL_PREFIX="/usr/local"

while [ $# -gt 0 ]
do
    case "$1" in
	--prefix=*)
	    INSTALL_PREFIX=$(echo $1 | cut -d '=' -f 2)
	    ;;
	--)
	    shift
	    break
	    ;;
    esac
    shift
done

for VAR in alsa jack QtGui
do
    printf "Search for $VAR headers... "
    INC=`pkg-config --cflags-only-I $VAR`
    if [ "$INC" = "" ];
    then
	echo "Error: $VAR header files not found!"
	exit
    else
	echo "ok"
    fi
done

qmake splitter/splitter.pro -o splitter/ PREFIX=$INSTALL_PREFIX
qmake vmm/vmm.pro -o vmm/ PREFIX=$INSTALL_PREFIX

echo -e "all:\n\tmake -C splitter\n\tmake -C vmm\ninstall:\n\tmake"\
" -C splitter install\n\tmake -C vmm install\n\tinstall -m 644 pianoutils.png"\
" $INSTALL_PREFIX/share/icons/hicolor/32x32/apps/\nclean:\n\tmake -C splitter"\
" clean\n\tmake -C vmm clean\nuninstall:\n\tmake -C splitter uninstall"\
"\n\tmake -C vmm uninstall" > Makefile